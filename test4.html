<style>
  body>div {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5em;
  }

  body>div>div {
    width: fit-content;
    height: fit-content;
    border: 2px solid darkgreen;
  }

  div.mono {
    display: grid;
    grid-auto-rows: 1fr;
    grid-auto-columns: auto;
    grid-auto-flow: row;
    font-family: monospace;
    text-align: center;
    width: max-content;
  }

  div.mono>div {
    border: 1px solid skyblue;
    padding: 0.1em;
    margin: 0;
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  div.mono>div:is(.del, .add, .cross, .match):hover::before {
    content: attr(a) " / " attr(b);
    position: absolute;
    bottom: 80%;
    left: 80%;
    background-color: yellow;
    z-index: 1000;
    width: max-content;
    padding: 0.2em;
    border: 1px dotted darkgrey;
  }

  div.mono>div.del {
    background-color: salmon;
  }

  div.mono>div.add {
    background-color: plum;
  }

  div.mono>div.cross {
    background-color: chocolate;
  }

  div.mono>div.match {
    background-color: lime;
  }

  div.mono>div.end {
    background-color: grey;
  }
</style>
<div></div>

<script type="module">
  import { diff, backtrace, levenshteinMinimalShifts } from "./difference4.js";

  function printGrid(rows, bt, actions, A, B) {
    const res = document.createElement("div");
    res.innerHTML = `<div class="mono" style="grid-template-columns: repeat(${B.length + 2}, max-content);">
      ${Array.from(rows).map(n => `<div a="" b="">${n >> 16}.${n & 0xFFFF}</div>`).join("")}
    </div>`;
    const children = res.lastElementChild.children;

    for (let p of bt) {
      children[p.n].classList.add(p.type);
      p.a && children[p.n].setAttribute("a", p.a);
      p.b && children[p.n].setAttribute("b", p.b);
    }
    children[0].insertAdjacentHTML("beforebegin", (" " + B).split("").map(c => `<div>${c}</div>`).join(""));
    A = "  " + A;
    for (let i = 0; i < A.length; i++)
      children[i * (B.length + 2)].insertAdjacentHTML("beforebegin", `<div>${A[i]}</div>`);
    res.insertAdjacentHTML("afterbegin",
      `<div class="actions">
      ${actions.map(({ a, b }) => `<div>${a == b ? "=" : !a ? "+" : !b ? "-" : "*"}  ${a} / ${b}</div>`).join("\n")}
    </div>`);
    return res;
  }

  function test(A, B) {
    const table = levenshteinMinimalShifts(A, B);
    const trace = [...backtrace(table, A, B)];
    const actions = diff(A, B);
    document.body.querySelector("div").append(printGrid(table, trace, actions, A, B));
    return { table, trace, actions };
  }

  const tests = [
    ["aby", "abx"],
    ["ab", "ab_a_bxx"],
    ["ab", "a_b_abxx"],
    ["ab_a_bx", "ab"],
    ["a_b_abx", "ab"],
    ["xxa_b_abx", "ab"],

    ["ab", "ab_a_b"],
    [".ab.", "_ab_a_b_"],
    ["abc", "ababcbc"],
    ["abcbc", "abc"],
    ["a", "b"],
    ["kitten", "sitting"],
    ["abc", "def"],
    ["abc", "abc"],
    ["a_b_cabc_ab_c", "abc"],
    ["", ""],
    ["abc", ""],
    ["", "abc"],
    ["abcdef", "ghijkl"],
    ["aaaa", "aa"],
    ["radar", "radar"],
    ["abcdef", "abXYef"],
    ["flaw", "lawn"],
    ["The quick brown fox", "The quick brown fix"],
    ["Hello, world!", "Hello world"],
  ];

  const testActions = tests.map(([a, b]) => test(a, b));

  const bigTests = (await import("./testset2.js")).default;
  for (const [a, b] of bigTests) {
    // debugger
    // test(a, b);
    // const diffs = diff(a, b);
    // console.log(diffs);
  }

</script>